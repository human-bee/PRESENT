---
alwaysApply: true
---
# Project-Level Reminders (Cursor Rules)

## Build, Run, Test

- Dev stack: `npm run stack:start` (runs LiveKit dev server, sync server, agents, Next.js)
- Separate terminals (alt):
  - `npm run agent:realtime`
  - `npm run agent:conductor`
  - `npm run dev`
  - `npm run sync:dev`
- Prod: `npm run build` → `npm run start` (web) + agents via `npm run agent:*`
- Quality: `npm test`, `npm run lint`

## Environment

- Copy `example.env.local` → `.env.local` and fill LiveKit, OpenAI, Supabase.
- Key flags (see docs/canvas-agent.md): `CANVAS_AGENT_UNIFIED`, `CANVAS_STEWARD_MODEL`, `NEXT_PUBLIC_CANVAS_AGENT_CLIENT_ENABLED`.

## Agents & Order of Operations

- Start the voice agent before the web app; wait for "registered worker" then "Job received!" in logs.
- Voice Agent enqueues; Conductor stewards execute; browser ToolDispatcher only applies `create_component` / `update_component` and TLDraw actions.

Note: The Voice Agent may hand off longer work via `dispatch_to_conductor`, and uses `reserve_component` / `resolve_component` for deterministic component IDs.

## Logging

- Tail logs in `logs/`: `agent-realtime.log`, `agent-conductor.log`, `livekit-server.log`, `next-dev.log`.
- Enable dispatcher metrics with `NEXT_PUBLIC_TOOL_DISPATCHER_METRICS=true` to log `tSend/tArrive/tPaint`.

## Linear & Tracking

- Track all code changes, features, and fixes in Linear.
- When tasks complete, update the corresponding Linear issue with a brief summary and relevant logs/screenshots.

## BrowserMCP & Testing

- Use Browser MCP to inspect console logs, run Playwright tests on the canvas UI, and capture screenshots before marking issues done.
- E2E: `npx playwright test tests/flowchart.e2e.spec.ts` and `tests/timer-perf.e2e.spec.ts`.

## Architectural Guardrails

- Keep files small (≤200 LOC where feasible); extract helpers early.
- Prefer hosted tools (Responses/MCP) over custom clients.
- Two UI tools in production: `create_component`, `update_component`.
- Supabase is the source of truth for transcripts and component docs.
