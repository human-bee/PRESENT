---
alwaysApply: true
---
# First Principles (Aligned with Docs)

## Core Rules

1) One agent hears; others think

- Voice Agent (Realtime): ears + intent + exactly two UI tools.
- Stewards (Agents SDK): own domain logic; return a single artifact/patch.
- Conductor: routes only.

2) Verbatim > "smart"

- Components are fully authored by the steward and applied verbatim.
- No silent normalizers or magic fixers.

3) Two UI tools in production

- `create_component({ type, spec })`
- `update_component({ componentId, patch })`

Note: The Voice Agent may also use non-UI helpers for routing/ledger:

- `dispatch_to_conductor({...})` (handoff to Conductor/Stewards)
- `reserve_component({...})`, `resolve_component({...})` (ID ledger)

4) One LLM call per trigger

- Realtime function call → execute → return `function_call_output` → continue.

5) Supabase = source of truth

- Transcripts and component docs (versioned) live in Supabase.

6) Typed everything

- Zod for tool params and outputs; explicit JSON contracts.

7) Small, boring files

- ≤200 LOC target; extract helpers early.

8) Prefer hosted tools

- Use Responses API + MCP over bespoke clients.

9) Debounce reality

- Stewards run on debounced transcript windows (2–4s under load).

10) Observability before cleverness

- Trace fetch → reason → commit. Log `prevVersion → nextVersion` for all commits.

---

## Anti-patterns

- Browser acting as agent (network calls/logic in ToolDispatcher).
- Heuristic rat’s nest (keyword routing; hidden fixers).
- Partial doc diffs that require local "normalizers" to patch up.
- Duplicate prompts/instructions competing for the same model.
- Silent failures (no `tool_error`, no trace).

---

## PR Checklist

- [ ] No heuristic/keyword routing added.
- [ ] Steward produces exactly one artifact/patch and a short text summary.
- [ ] All new params are zod-typed.
- [ ] Files stay ≤200 LOC (or justify).
- [ ] Tracing visible; errors surface as `tool_error`.
- [ ] Notes call out any required docs updates.

---

## Architecture (short)

- Voice hears + calls 2 tools. Stewards think + write full artifacts. Browser applies. Supabase remembers.

See also: `docs/FIRST_PRINCIPLES.md` for extended rationale.
